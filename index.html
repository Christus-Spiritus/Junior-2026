<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Christus Junior</title>
  <style>
    :root{
      --bg:#0b1220; --text:#e8eefc; --muted:#a7b4d6;
      --accent:#7aa2ff; --ok:#4ade80; --warn:#fbbf24; --bad:#fb7185;
      --line:rgba(255,255,255,.10);
    }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#070b14,var(--bg)); color:var(--text); }
    .wrap{ max-width:1020px; margin:0 auto; padding:18px; }
    .card{ background:rgba(17,26,46,.88); border:1px solid rgba(122,162,255,.15);
      border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25); }
    h1{ font-size:20px; margin:0 0 6px; }
    h2{ font-size:14px; margin:14px 0 8px; color:var(--muted); font-weight:800; }
    .sub{ color:var(--muted); font-size:13px; margin:0 0 10px; line-height:1.5; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    .pill{ font-size:12px; color:var(--muted); border:1px solid var(--line); padding:6px 10px; border-radius:999px; }
    .btn{ background:rgba(122,162,255,.14); color:var(--text); border:1px solid rgba(122,162,255,.35);
      padding:10px 12px; border-radius:12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; gap:8px; }
    .btn:active{ transform:translateY(1px); }
    .btn[aria-disabled="true"]{ opacity:.45; pointer-events:none; }
    .btn.secondary{ background:rgba(255,255,255,.08); border:1px solid var(--line); }
    .btn.warn{ background:rgba(251,191,36,.10); border:1px solid rgba(251,191,36,.35); }
    .btn.bad{ background:rgba(251,113,133,.10); border:1px solid rgba(251,113,133,.35); }
    .progress{ width:100%; height:10px; background:rgba(255,255,255,.10); border-radius:999px; overflow:hidden; }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--ok)); transition:width .25s ease; }
    .grid{ display:grid; gap:12px; }
    @media (min-width: 920px){ .grid{ grid-template-columns:1.15fr .85fr; } }

    ul{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
    li{ display:flex; gap:10px; align-items:flex-start; padding:10px; border-radius:12px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); }
    input[type="checkbox"]{ transform:scale(1.25); margin-top:2px; }
    .task{ flex:1; }
    .task b{ display:block; font-weight:800; }
    .meta{ color:var(--muted); font-size:12px; margin-top:2px; }
    .tag{ display:inline-block; font-size:11px; padding:2px 8px; border-radius:999px; border:1px solid var(--line); color:var(--muted); margin-left:6px; }

    .section{ padding:12px; border-radius:14px; border:1px solid var(--line); background:rgba(0,0,0,.12); }
    .foot{ margin-top:10px; color:var(--muted); font-size:12px; line-height:1.5; }
    .hr{ height:1px; background:var(--line); margin:12px 0; }

    .quote{ padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.05); }
    .quote b{ font-weight:900; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div>
        <h1>Christus Junior</h1>
        <p class="sub" id="dateLabel"></p>
      </div>
      <div class="pill" id="rangeLabel"></div>
    </div>

    <!-- Accueil pastoral (simple) -->
    <div class="quote" style="margin-top:10px">
      <b>Bienvenue</b> üôè<br/>
      <span class="sub" style="margin:6px 0 0; display:block">
        Un petit pas chaque jour : pri√®re, sobri√©t√©, charit√©. L‚Äôimportant, c‚Äôest de revenir au Christ.
      </span>
    </div>

    <div class="row" style="margin-top:12px">
      <div class="pill">Objectifs du jour</div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
        <button class="btn secondary" id="prevDay">‚Üê Jour</button>
        <button class="btn secondary" id="today">Aujourd‚Äôhui</button>
        <button class="btn secondary" id="nextDay">Jour ‚Üí</button>
        <a class="btn" id="aelfLink" target="_blank" rel="noopener">üìñ √âvangile du jour (AELF)</a>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="row" style="justify-content:space-between; margin-bottom:8px">
        <span class="pill">Aujourd‚Äôhui : <b id="dayPct">0%</b></span>
        <span class="pill">Semaine : <b id="weekPct">0%</b></span>
        <span class="pill">Car√™me : <b id="seasonPct">0%</b></span>
      </div>
      <div class="progress"><div class="bar" id="dayBar"></div></div>
      <div class="progress" style="margin-top:8px"><div class="bar" id="weekBar"></div></div>
      <div class="progress" style="margin-top:8px"><div class="bar" id="seasonBar"></div></div>
    </div>

    <div class="hr"></div>

    <div class="grid">
      <div class="section">
        <h2>√Ä faire aujourd‚Äôhui</h2>
        <ul id="todayTasks"></ul>
        <div class="foot" id="dayHint"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-start; gap:10px">
          <button class="btn warn" id="resetDay">R√©initialiser le jour</button>
        </div>
      </div>

      <div class="section">
        <h2>√Ä faire cette semaine</h2>
        <p class="sub" id="weekLabel" style="margin-bottom:10px"></p>
        <ul id="weekTasks"></ul>

        <div class="hr"></div>

        <h2>Avant P√¢ques</h2>
        <ul id="seasonTasks"></ul>

        <div class="row" style="margin-top:12px; justify-content:flex-start; gap:10px">
          <button class="btn warn" id="resetWeek">R√©initialiser la semaine</button>
          <button class="btn bad" id="resetAll">Tout r√©initialiser</button>
        </div>

        <div class="foot">
          ‚ÄúSemaine‚Äù = lundi ‚Üí dimanche. Le bouton AELF ouvre la messe du jour.
        </div>
      </div>
    </div>

    <!-- Image en bas -->
    <div class="hr"></div>
    <div class="section" style="text-align:center">
      <h2>Parcours</h2>
      <img
        src="parcours-christus.png"
        alt="Parcours Christus"
        style="width:100%; max-width:520px; height:auto; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.10);"
      />
      <div class="foot">Astuce : ajoute cette page √† l‚Äô√©cran d‚Äôaccueil pour l‚Äôutiliser comme une appli.</div>
    </div>

  </div>
</div>

<script>
(() => {
  // --- P√©riode Car√™me 2026
  const START = new Date("2026-02-18T00:00:00"); // Mercredi des Cendres
  const END   = new Date("2026-04-05T00:00:00"); // Dimanche de P√¢ques

  const KEY = "christus_junior_v1";
  const $ = (id) => document.getElementById(id);

  // --- AELF URL (messe du jour)
  function aelfUrl(iso){ return `https://www.aelf.org/${iso}/romain/messe`; }

  // --- Objectifs (niveau ‚Äúgrain de s√©nev√©‚Äù, sans afficher le nom)
  const TASKS = {
    daily: [
      { id:"oraison", label:"Oraison : 15 minutes", cat:"Discipline spirituelle" },
      { id:"chapelet", label:"Chapelet : au moins une dizaine", cat:"Discipline spirituelle" },
      { id:"lecture", label:"Lecture : √âvangile ou liturgie du jour", cat:"Discipline spirituelle" },
      { id:"sobriete", label:"Sobri√©t√© num√©rique : pas apr√®s 21h", cat:"Asc√®se" },
      { id:"sommeil", label:"Sommeil : viser au moins 8h", cat:"Asc√®se" }  // ‚úÖ 8h
    ],
    weekdayOnly: [
      { id:"jeune_vendredi", label:"Je√ªne : vendredi", cat:"Asc√®se", days:[5] },
      { id:"abstinence_vendredi", label:"Abstinence : vendredi (viande)", cat:"Asc√®se", days:[5] },
    ],
    weekly: [
      { id:"aumone", label:"Aum√¥ne : 1 geste concret", cat:"Charit√© & fraternit√©" },
      { id:"fraternite", label:"Fraternit√© : partager 1 fois dans la semaine", cat:"Charit√© & fraternit√©" },
    ],
    season: [
      { id:"confession", label:"Confession : au moins 1 fois avant P√¢ques", cat:"Discipline spirituelle" },
    ]
  };

  // --- Helpers dates
  function clampToRange(d){
    const x = new Date(d); x.setHours(0,0,0,0);
    if(x < START) return new Date(START);
    if(x > END) return new Date(END);
    return x;
  }
  function toISODate(d){
    const x = new Date(d); x.setHours(0,0,0,0);
    const yyyy = x.getFullYear();
    const mm = String(x.getMonth()+1).padStart(2,'0');
    const dd = String(x.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }
  function addDays(d, n){
    const x = new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x;
  }
  function dayOfWeek(d){ return new Date(d).getDay(); } // 0 Sun .. 6 Sat
  function startOfWeekMonday(d){
    const x = new Date(d); x.setHours(0,0,0,0);
    const day = x.getDay();
    const diff = (day === 0 ? -6 : 1 - day);
    x.setDate(x.getDate()+diff);
    return x;
  }
  function formatFR(d){
    return new Intl.DateTimeFormat('fr-FR', { weekday:'long', year:'numeric', month:'long', day:'numeric' }).format(d);
  }
  function formatShortFR(d){
    return new Intl.DateTimeFormat('fr-FR', { day:'2-digit', month:'2-digit' }).format(d);
  }
  function pct(done, total){ return total ? Math.round((done/total)*100) : 0; }
  function inRangeISO(iso){
    const d = new Date(iso+"T00:00:00");
    return d >= START && d <= END;
  }

  // --- Storage
  function load(){
    try { return JSON.parse(localStorage.getItem(KEY)) || {}; }
    catch { return {}; }
  }
  function save(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

  // state:
  // days[iso] = { daily:{}, weekdayOnly:{} }
  // weeks[weekIsoMonday] = { weekly:{} }
  // season = { confession: bool }
  let state = load();
  if(!state.days) state.days = {};
  if(!state.weeks) state.weeks = {};
  if(!state.season) state.season = { season:{} };

  function ensureDay(iso){
    if(!state.days[iso]) state.days[iso] = { daily:{}, weekdayOnly:{} };
    TASKS.daily.forEach(t => {
      if(typeof state.days[iso].daily[t.id] !== "boolean") state.days[iso].daily[t.id] = false;
    });
    TASKS.weekdayOnly.forEach(t => {
      if(typeof state.days[iso].weekdayOnly[t.id] !== "boolean") state.days[iso].weekdayOnly[t.id] = false;
    });
  }

  function ensureWeek(weekIso){
    if(!state.weeks[weekIso]) state.weeks[weekIso] = { weekly:{} };
    TASKS.weekly.forEach(t => {
      if(typeof state.weeks[weekIso].weekly[t.id] !== "boolean") state.weeks[weekIso].weekly[t.id] = false;
    });
  }

  function ensureSeason(){
    if(!state.season) state.season = { season:{} };
    TASKS.season.forEach(t => {
      if(typeof state.season.season[t.id] !== "boolean") state.season.season[t.id] = false;
    });
  }

  function weekKey(dayDate){
    const ws = startOfWeekMonday(dayDate);
    return { ws, we: addDays(ws,6), key: toISODate(ws) };
  }

  let current = clampToRange(new Date());

  function updateHeader(){
    const iso = toISODate(current);
    $("dateLabel").textContent = formatFR(current);
    $("rangeLabel").textContent = `Du ${formatShortFR(START)} au ${formatShortFR(END)} (Car√™me 2026)`;
    $("aelfLink").href = aelfUrl(iso);

    $("prevDay").setAttribute("aria-disabled", current <= START ? "true" : "false");
    $("nextDay").setAttribute("aria-disabled", current >= END ? "true" : "false");
  }

  function tasksTodayFor(date){
    const out = [];
    TASKS.daily.forEach(t => out.push({ ...t, scope:"daily" }));
    const dow = dayOfWeek(date);
    TASKS.weekdayOnly.forEach(t => {
      if(t.days && t.days.includes(dow)){
        out.push({ ...t, scope:"weekdayOnly", extra: (dow===5 ? "Vendredi" : "Jour") });
      }
    });
    return out;
  }

  function renderToday(){
    const iso = toISODate(current);
    ensureDay(iso);

    const list = $("todayTasks");
    list.innerHTML = "";

    const tasks = tasksTodayFor(current);
    tasks.forEach(t => {
      const li = document.createElement("li");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = (t.scope === "daily")
        ? state.days[iso].daily[t.id]
        : state.days[iso].weekdayOnly[t.id];

      cb.addEventListener("change", () => {
        if(t.scope === "daily") state.days[iso].daily[t.id] = cb.checked;
        else state.days[iso].weekdayOnly[t.id] = cb.checked;
        save(state);
        updateProgress();
      });

      const div = document.createElement("div");
      div.className = "task";
      const b = document.createElement("b");
      b.textContent = t.label;
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = t.cat;
      if(t.extra){
        const span = document.createElement("span");
        span.className = "tag";
        span.textContent = t.extra;
        meta.appendChild(span);
      }

      div.appendChild(b);
      div.appendChild(meta);

      li.appendChild(cb);
      li.appendChild(div);
      list.appendChild(li);
    });

    const dow = dayOfWeek(current);
    let hint = "‚úÖ Un petit pas aujourd‚Äôhui. Si tu rates, tu reprends demain.";
    if(dow === 5) hint = "‚ú® Aujourd‚Äôhui c‚Äôest <b>vendredi</b> : je√ªne + abstinence.";
    if(dow === 0) hint = "üåø Dimanche : garde la joie et l‚Äôaction de gr√¢ce.";
    $("dayHint").innerHTML = hint;
  }

  function renderWeek(){
    const { ws, we, key } = weekKey(current);
    ensureWeek(key);

    $("weekLabel").textContent = `Semaine : ${formatShortFR(ws)} ‚Üí ${formatShortFR(we)}`;

    const list = $("weekTasks");
    list.innerHTML = "";

    TASKS.weekly.forEach(t => {
      const li = document.createElement("li");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = state.weeks[key].weekly[t.id];

      cb.addEventListener("change", () => {
        state.weeks[key].weekly[t.id] = cb.checked;
        save(state);
        updateProgress();
      });

      const div = document.createElement("div");
      div.className = "task";
      const b = document.createElement("b");
      b.textContent = t.label;
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = t.cat;

      div.appendChild(b);
      div.appendChild(meta);

      li.appendChild(cb);
      li.appendChild(div);
      list.appendChild(li);
    });
  }

  function renderSeason(){
    ensureSeason();
    const list = $("seasonTasks");
    list.innerHTML = "";

    TASKS.season.forEach(t => {
      const li = document.createElement("li");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!state.season.season[t.id];

      cb.addEventListener("change", () => {
        state.season.season[t.id] = cb.checked;
        save(state);
        updateProgress();
      });

      const div = document.createElement("div");
      div.className = "task";
      const b = document.createElement("b");
      b.textContent = t.label;
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = t.cat;

      div.appendChild(b);
      div.appendChild(meta);

      li.appendChild(cb);
      li.appendChild(div);
      list.appendChild(li);
    });
  }

  function todayProgress(){
    const iso = toISODate(current);
    ensureDay(iso);

    const tasks = tasksTodayFor(current);
    let done = 0;
    tasks.forEach(t => {
      const v = (t.scope === "daily") ? state.days[iso].daily[t.id] : state.days[iso].weekdayOnly[t.id];
      if(v) done++;
    });

    return { done, total: tasks.length, pct: pct(done, tasks.length) };
  }

  function weekProgress(){
    const { ws, key } = weekKey(current);
    ensureWeek(key);

    let total = 0, done = 0;

    for(let i=0;i<7;i++){
      const d = new Date(ws); d.setDate(ws.getDate()+i); d.setHours(0,0,0,0);
      const iso = toISODate(d);
      if(!inRangeISO(iso)) continue;

      ensureDay(iso);
      const tasks = tasksTodayFor(d);
      total += tasks.length;
      tasks.forEach(t => {
        const v = (t.scope === "daily") ? state.days[iso].daily[t.id] : state.days[iso].weekdayOnly[t.id];
        if(v) done++;
      });
    }

    total += TASKS.weekly.length;
    TASKS.weekly.forEach(t => { if(state.weeks[key].weekly[t.id]) done++; });

    return { done, total, pct: pct(done,total) };
  }

  function seasonProgress(){
    ensureSeason();

    let total = 0, done = 0;

    for(let d=new Date(START); d<=END; d=addDays(d,1)){
      const iso = toISODate(d);
      ensureDay(iso);

      const tasks = tasksTodayFor(d);
      total += tasks.length;
      tasks.forEach(t => {
        const v = (t.scope === "daily") ? state.days[iso].daily[t.id] : state.days[iso].weekdayOnly[t.id];
        if(v) done++;
      });
    }

    const seenWeeks = new Set();
    for(let d=new Date(START); d<=END; d=addDays(d,1)){
      const wk = weekKey(d).key;
      if(seenWeeks.has(wk)) continue;
      seenWeeks.add(wk);

      ensureWeek(wk);
      total += TASKS.weekly.length;
      TASKS.weekly.forEach(t => { if(state.weeks[wk].weekly[t.id]) done++; });
    }

    total += TASKS.season.length;
    TASKS.season.forEach(t => { if(state.season.season[t.id]) done++; });

    return { done, total, pct: pct(done,total) };
  }

  function updateProgress(){
    const dp = todayProgress();
    const wp = weekProgress();
    const sp = seasonProgress();

    $("dayPct").textContent = `${dp.pct}%`;
    $("weekPct").textContent = `${wp.pct}%`;
    $("seasonPct").textContent = `${sp.pct}%`;

    $("dayBar").style.width = `${dp.pct}%`;
    $("weekBar").style.width = `${wp.pct}%`;
    $("seasonBar").style.width = `${sp.pct}%`;
  }

  function renderAll(){
    current = clampToRange(current);
    updateHeader();
    renderToday();
    renderWeek();
    renderSeason();
    updateProgress();
  }

  // Navigation
  $("prevDay").addEventListener("click", () => {
    if(current <= START) return;
    current = addDays(current, -1);
    renderAll();
  });
  $("nextDay").addEventListener("click", () => {
    if(current >= END) return;
    current = addDays(current, 1);
    renderAll();
  });
  $("today").addEventListener("click", () => {
    current = clampToRange(new Date());
    renderAll();
  });

  // Reset
  $("resetDay").addEventListener("click", () => {
    const iso = toISODate(current);
    ensureDay(iso);

    const tasks = tasksTodayFor(current);
    tasks.forEach(t => {
      if(t.scope === "daily") state.days[iso].daily[t.id] = false;
      else state.days[iso].weekdayOnly[t.id] = false;
    });

    save(state);
    renderAll();
  });

  $("resetWeek").addEventListener("click", () => {
    const { key } = weekKey(current);
    ensureWeek(key);
    TASKS.weekly.forEach(t => state.weeks[key].weekly[t.id] = false);
    save(state);
    renderAll();
  });

  $("resetAll").addEventListener("click", () => {
    const ok = confirm(
      "√ätes-vous s√ªr de vouloir tout r√©initialiser ?\n\n" +
      "Cette action effacera toutes les coches enregistr√©es sur cet appareil."
    );
    if(!ok) return;

    localStorage.removeItem(KEY);
    state = { days:{}, weeks:{}, season:{ season:{} } };
    save(state);
    renderAll();
  });

  // Init
  save(state);
  current = clampToRange(new Date());
  renderAll();
})();
</script>
</body>
</html>
